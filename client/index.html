<!doctype html>
  <html lang="en">
    <head>
      <meta charset="UTF-8">
        <title>Battle Droids</title>
        <link rel="stylesheet" type="text/css" href="/client/css/style.css">
    </head>
    <!-- <body onload="init()"> -->
    <body>
      <main>
        <div class="stars"></div>
        <div class="twinkling"></div>
        <div class="clouds"></div>
        <canvas id="ship" width="800" height="420">
          Your browser does not support canvas.
          Please try again with a different browser.
        </canvas>

    </main>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
   canvasApp();
});

let canvasApp = () => {
   let canvas = document.getElementById("ship");
   let context = canvas.getContext("2d");

   let rotation = 0;
   let x = 50;
   let y = 50;
   let facingX = 0;
   let facingY = 0;
   let movingX = 0;
   let movingY = 0;
   let width = 20;
   let height = 20;
   let rotationalVelocity = 5; //how many degrees to turn the ship
   let thrust = .03;
   let map = [];
   let canvasWidth = canvas.width;
   let canvasHeight = canvas.height;

   let shipState = 0; //0 = static, 1 = thrust

   function drawCanvas() {

     // background
     context.fillStyle = '#000000';
     context.fillRect(0, 0, canvasWidth, canvasHeight);
     context.fillStyle = '#ffffff';

     //  transform
     let radians = rotation * Math.PI / 180;
     context.save();    // save the current stack
     context.setTransform(1,0,0,1,0,0); //  reset to identity

     //  canvas origin Player center
     context.translate(x+.5*width,y+.5*height);
     context.rotate(radians);

     //drawShip
     context.strokeStyle = '#ffffff';
     context.beginPath();

      // draw the ship
      // set rotation to image center
      context.moveTo(-10,-10);
      context.lineTo(10,0);
      context.moveTo(10,1);
      context.lineTo(-10,10);
      context.lineTo(1,1);
      context.moveTo(1,-1);
      context.lineTo(-10,-10);

     context.stroke();
     context.closePath();

     //  restore context
     context.restore();

      //update the shipState
      shipState++;
      if (shipState >1) {
         shipState=0;
      }
      if (shipState==1) {
        //draw thrust
        context.moveTo(8,13);
        context.lineTo(11,13);
        context.moveTo(9,14);
        context.lineTo(9,18);
        context.moveTo(10,14);
        context.lineTo(10,18);
      }
    }


    function incrementAngle() {
         angle += 5;
      if(angle > 360){
        angle = 0;
        }
    }
    function decrementAngle(){
      angle -= 5;
      if(angle > 360){
        angle = 0;
        }
    }
    let convertToRadians = (degree) => {
        return degree*(Math.PI/180);
    }

    let boundry = () => {
      if (x<=0)
        x=0;
      if (y<=0)
        y=0;
      if (x >= canvas.width - width*2)
        x = canvas.width - width*2;
      if (y >= canvas.height - height*2)
        y = canvas.height - height*2;
    }

   const FRAME_RATE = 40;
   let intervalTime = 1000/FRAME_RATE;
   setInterval(function () {
     drawCanvas();
     boundry();
     keyPress();
   }, intervalTime );

   document.onkeydown = function(e){
      e = e?e:window.event;
      map[e.keyCode] = true;
   }

   document.onkeyup = function(e){
      e = e?e:window.event;
      map[e.keyCode] = false;
   };

   let keyPress = () => {
     if (map[38] == true) {
       let radians = rotation * Math.PI/180;
       facingX = Math.cos(radians);
       facingY = Math.sin(radians);

       movingX = movingX + thrust*facingX;
       movingY = movingY + thrust*facingY;
     }

     if (map[37]==true) {
       //  decrementAngle
       rotation -= rotationalVelocity;
     }

      if (map[39]==true) {
        // incrementAngle
        rotation += rotationalVelocity;
      }

     x = x + movingX;
     y = y + movingY;
   }
}
// requestAnim shim layer by Paul Irish
window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame   ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame    ||
      window.oRequestAnimationFrame      ||
      window.msRequestAnimationFrame     ||
      function(/* function */ callback, /* DOMElement */ element){
        window.setTimeout(callback, 1000 / 250);
      };
})();




</script>
</body>
</html>
