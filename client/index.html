<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="/client/css/style.css">
  </head>

  <!-- <body onload="init()"> -->
  <body>
    <main >
      <div class="stars"></div>
      <div class="twinkling"></div>
      <div class="clouds"></div>

      <!-- The canvas for the panning background -->
  		<canvas id="background" width='600' height='360'>
  			Your browser does not support canvas.
        Please try again with a different browser.
  		</canvas>
  		<canvas id="ship" width="600" height="360">

    </main>

   <!-- <script src='/client/js/main.js'></script> -->
   <script>
    document.addEventListener("DOMContentLoaded", function(event) {
      let x = 200;
      let y = 200;
      let width = 57;
      let height = 101;

      let shipCanvas = document.getElementById('ship');
      let shipContext = shipCanvas.getContext('2d');
      let imgSpaceship = new Image();

      let map = [ false, false, false, false ];

      var clearScreen = function () {
        shipContext.clearRect(0, 0, 600, 360 );
      }

      //  define Ship class
      let Ship = function () {
        this.x = 50;
        this.y = 50;
        this.h = 50;
        this.w = 50;
        this.speed = 0;
      };

      //  draw method Ship class
      Ship.prototype.draw = () => {
        shipContext.drawImage(imgSpaceship, x, y);
        imgSpaceship.src = "/client/imgs/ship2.png";
      };

      // move method ship class
      Ship.prototype.move = () => {
        speed = 4;
        clearScreen();
        if(map[0]) {
          y-=speed;  // up
          boundry();
        }
        if(map[1]) {
          x+=speed; // right
          boundry();
        }
        if(map[2]) {
          y+=speed; // down
          boundry();
        }
        if(map[3]) {
          x-=speed; // left
          boundry();
        }
        ship.draw();
      };

      //  keep objects on the screen
      let boundry = () => {
        if (x<=0)
          x=0;
        if (y<=0)
          y=0;
        if (x >= shipCanvas.width - width)
          x = shipCanvas.width - width;
        if (y >= shipCanvas.height - height)
          y = shipCanvas.height - height;
      }

      let mapKeys = (e, enabling) => {
        e.preventDefault();
        if(e.keyCode == 38) map[0] = enabling; // up
        if(e.keyCode == 39) map[1] = enabling; // right
        if(e.keyCode == 40) map[2] = enabling; // down
        if(e.keyCode == 37) map[3] = enabling; // left
      }

      document.onkeydown = (e) => {
        mapKeys(e, true);
      }

      document.onkeyup = (e) => {
        mapKeys(e, false);
      }

      //  Make a new ship
      let ship = new Ship();
      ship.draw();

      function render () {
        ship.move( map );

        requestAnimFrame( render );
      }(render());  //  IIFE calls itself
    });

    // requestAnim shim layer by Paul Irish
    window.requestAnimFrame = (function(){
    	return  window.requestAnimationFrame   ||
    			window.webkitRequestAnimationFrame ||
    			window.mozRequestAnimationFrame    ||
    			window.oRequestAnimationFrame      ||
    			window.msRequestAnimationFrame     ||
    			function(/* function */ callback, /* DOMElement */ element){
    				window.setTimeout(callback, 1000 / 250);
    			};
    })();
   </script>

  </body>
</html>
